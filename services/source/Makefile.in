DEFINES=@DEFS@
RM=@RM@
CXX=@CXX@
CXXFLAGS=@CXXFLAGS@
LDFLAGS=
LIBS=@LIBS@

SOURCES=module.cpp
INCLUDES=../include

OBJECTS=$(SOURCES:.cpp=.o)

TARGET=mod_exordium.so

SUBDIRS=\
	lib \
	modules

.PHONY: all subdirs $(SUB_DIRS)

all: all-recursive $(TARGET)

$(TARGET): $(OBJECTS)
	$(CXX) -o $@ $(OBJECTS) $(LIBS) -L/usr/local/mysql/lib/mysql \
		$(LDFLAGS)  -L./lib/ -lservices -fPIC -shared

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(DEFINES) -I/usr/local/ssl/include -I$(INCLUDES) -I/usr/local/mysql/include/ -I../../kineircd/src/lib -I../../kineircd/include -I../include/  -c $< 


clean: clean-recursive
	$(RM) *.o *~ services *.log

distclean: distclean-recursive
	$(RM) *.o *~ services *.log Makefile

pretty:
	indent *.cpp
	indent *.h
	$(RM) *~

all-recursive clean-recursive distclean-recursive:
	@target=`echo $@ | sed s/-recursive//`; \
	list='$(SUBDIRS)'; for subdir in $$list; do \
	      echo "Making $$target in $$subdir"; \
	      (cd $$subdir && $(MAKE) $$target) \
	      || exit 1; \
	done;
