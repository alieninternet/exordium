DEFINES=@DEFS@
RM=@RM@
CXX=@CXX@
CXXFLAGS=@CXXFLAGS@
LDFLAGS=
LIBS=@LIBS@

SOURCES=module.cpp
INCLUDES=../include

OBJECTS=$(SOURCES:.cpp=.o)

TARGET=mod_exordium.so

SUB_DIRS=\
	lib \
	modules

.PHONY: all subdirs $(SUB_DIRS)

all: $(TARGET)

subdirs: $(SUB_DIRS)

$(SUB_DIRS):
	$(MAKE) -C $@

$(TARGET): subdirs $(OBJECTS)
	$(CXX) -o $@ $(OBJECTS) $(LIBS) -L/usr/local/mysql/lib/mysql \
		$(LDFLAGS)  -L./lib/ -lservices \
		-fPIC -shared -g3 -Wall -Werror -O0 -fpic -ggdb3 -pg \
		-fno-rtti -fvtable-gc

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(DEFINES) -I/usr/local/ssl/include -I$(INCLUDES) -I/usr/local/mysql/include/ -I../../kineircd/src/lib -I../../kineircd/include -I../include/  -c $< 


clean:
	$(RM) *.o *~ services *.log

distclean:
	$(RM) *.o *~ services *.log Makefile

pretty:
	indent *.cpp
	indent *.h
	$(RM) *~


