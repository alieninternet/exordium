/* $Id$
 *
 * Linkage map to show how libraries and modules link within Exordium 
 * and KineIRCd (roughly).
 *
 * Boxes for binaries, diamonds for libraries and ellipses for modules. Black
 * solid lines for required library links, black dashed lines for optional
 * library links, blue lines for dynamic modules.
 *
 * This can be generated into a neat little picture using the AT&T GraphViz
 * utilities (found at http://www.research.att.com/sw/tools/graphviz/).
 *
 * eg.
 *   dot -Tpng -o linkmap.png linkmap.dat
 *
 * Note: 
 *  This graph probably needs link-ranks and graph page size to be defined to
 *  make it a lot easier to read. Where possible, things are listed in
 *  alphabetical order to make things easier to maintain.
 */

digraph intranet_map {
  graph [splines=true,overlap=false];
  node [style=filled];
  decorate=true;
  sep=0.1;

  // Binaries
  node [shape=box,color=indianred1];
  {  rank=min;
     "KineIRCd";
  };
  
  // External/System Libraries
//  subgraph "syslibs" {
//     label="External/System Libraries";
//     color=black;
  
     node [shape=diamond,color=lightblue];
     "libaisutil";
     "libdl";
     "libmysqlclient";
     "libnetsnmp";
     "libnetsnmpagent";
     "libnetsnmphelpers";
     "libnetsnmpmibs";
     "libpq"; // postgresql
     "libssl";
     "libxml2";
//  };

  // KineIRCd library
  node [shape=diamond,color=lightblue];
  "libkineircd";
  
  // KineIRCd module libraries
  node [shape=diamond,color=lightblue];
  "libkineircd_irc2";

  // KineIRCd modules
  node [shape=ellipse,color=lightgoldenrod];
  {  rank=same;
     "mod_http";
     "mod_iirc1";
     "mod_irc2server";
     "mod_irc2user";
     "mod_snmp";
  };

  // Linkage map
  "KineIRCd" -> "libaisutil";
  "KineIRCd" -> "libkineircd";
  "libkineircd" -> "mod_exordium" [color=blue,dir=both];
  "libkineircd" -> "mod_http" [color=blue,dir=both];
  "libkineircd" -> "mod_iirc1" [color=blue,dir=both];
  "libkineircd" -> "mod_irc2server" [color=blue,dir=both];
  "libkineircd" -> "mod_irc2user" [color=blue,dir=both];
  "libkineircd" -> "mod_snmp" [color=blue,dir=both];
  "libkineircd" -> "libaisutil";
  "libkineircd" -> "libdl";
  "libkineircd" -> "libssl" [style=dashed];
  "mod_http" -> "libaisutil";
  "mod_http" -> "libxml2";
  "mod_iirc1" -> "libaisutil";
  "mod_irc2server" -> "libaisutil";
  "mod_irc2server" -> "libkineircd_irc2";
  "mod_irc2user" -> "libaisutil";
  "mod_irc2user" -> "libkineircd_irc2";
  "mod_snmp" -> "libaisutil";
  "mod_snmp" -> "libnetsnmp";
  "mod_snmp" -> "libnetsnmpagent";
  "mod_snmp" -> "libnetsnmphelpers";
  "mod_snmp" -> "libnetsnmpmibs";
  "libkineircd_irc2" -> "libaisutil";
  "libkineircd_irc2" -> "libkineircd";

  subgraph "exordium" {
     label="Exordium Network Services";
     color=black;

     // The KineIRCd module (Exordium)
     node [shape=ellipse,color=lightgoldenrod];
     "mod_exordium";
  
     // Exordium library
     node [shape=diamond,color=lightblue];
     "libexordium";
  
     // Exordium modules
     node [shape=ellipse,color=palegreen];
     {  rank=same;
        "mod_bot.so";
        "mod_chan.so";
        "mod_game.so";
        "mod_love.so";
        "mod_nick.so";
        "mod_note.so";
        "mod_oper.so";
        "mod_serv.so";
        "mod_stats.so";
        "mod_vote.so";
     };

     // Exordium module libraries
     node [shape=diamond,color=lightblue];
     "libexordium_game";

     // Exordium game module modules
     node [shape=ellipse,color=turquoise];
     {  rank=same;
        "game_exordi8.so";
        "game_hangman.so";
     };

     // Linkage map..
     "mod_exordium" -> "libaisutil";
     "mod_exordium" -> "libdl";
     "mod_exordium" -> "libexordium";
     "libexordium" -> "libaisutil";
     "libexordium" -> "libkineircd";
     "libexordium" -> "libmysqlclient" [style=dashed];
     "libexordium" -> "libpq" [style=dashed];
     "libexordium" -> "mod_bot.so" [color=blue,dir=both];
     "libexordium" -> "mod_chan.so" [color=blue,dir=both];
     "libexordium" -> "mod_game.so" [color=blue,dir=both];
     "libexordium" -> "mod_love.so" [color=blue,dir=both];
     "libexordium" -> "mod_nick.so" [color=blue,dir=both];
     "libexordium" -> "mod_note.so" [color=blue,dir=both];
     "libexordium" -> "mod_oper.so" [color=blue,dir=both];
     "libexordium" -> "mod_serv.so" [color=blue,dir=both];
     "libexordium" -> "mod_stats.so" [color=blue,dir=both];
     "libexordium" -> "mod_vote.so" [color=blue,dir=both];
     "libexordium_game" -> "libaisutil";
     "libexordium_game" -> "libdl";
     "libexordium_game" -> "libexordium";
     "libexordium_game" -> "game_exordi8.so" [color=blue,dir=both];
     "libexordium_game" -> "game_hangman.so" [color=blue,dir=both];
     "mod_bot.so" -> "libaisutil";
     "mod_chan.so" -> "libaisutil";
     "mod_game.so" -> "libaisutil";
     "mod_game.so" -> "libexordium_game" [dir=both];
     "mod_love.so" -> "libaisutil";
     "mod_nick.so" -> "libaisutil";
     "mod_note.so" -> "libaisutil";
     "mod_oper.so" -> "libaisutil";
     "mod_serv.so" -> "libaisutil";
     "mod_stats.so" -> "libaisutil";
     "mod_vote.so" -> "libaisutil";
  };
};
